---
import FormattedDate from './FormattedDate.astro';
import type { CollectionEntry } from 'astro:content';

interface Props {
    posts: CollectionEntry<'blog'>[];
}

const { posts } = Astro.props;

// Group posts by year
const postsByYear = posts.reduce((acc, post) => {
    const year = post.data.pubDate.getFullYear();
    if (!acc[year]) {
        acc[year] = [];
    }
    acc[year].push(post);
    return acc;
}, {} as Record<number, typeof posts>);

const years = Object.keys(postsByYear).sort((a, b) => Number(b) - Number(a));
---

<div class="space-y-8">
    {years.map(year => (
            <section class="relative">
                <h3 class="text-6xl font-bold text-zinc-200 dark:text-white/5 absolute -left-4 -top-6 -z-10 select-none">
                    {year}
                </h3>
                <div class="relative pl-2">
                    <div class="flex items-center gap-4 mb-6">
                        <span class="text-2xl font-bold text-zinc-800 dark:text-zinc-100">{year}</span>
                        <div class="h-px flex-grow bg-zinc-200 dark:bg-white/10"></div>
                    </div>

                    <div class="space-y-4">
                        {postsByYear[Number(year)].map(post => (
                                <article class="post-item group relative flex flex-col sm:flex-row gap-4 sm:items-center justify-between p-4 rounded-2xl hover:bg-white/50 dark:hover:bg-white/5 transition-colors border border-transparent hover:border-zinc-200 dark:hover:border-white/10"
                                         data-title={post.data.title.toLowerCase()}
                                         data-tags={post.data.tags?.join(',') || ''}
                                         data-categories={post.data.categories?.join(',') || ''}
                                >
                                    <div class="flex-grow min-w-0">
                                        <div class="flex items-center gap-3 mb-1 text-xs text-zinc-500 dark:text-zinc-400">
                                            <FormattedDate date={post.data.pubDate} />
                                            {post.data.categories && (
                                                    <>
                                                        <span>â€¢</span>
                                                        <span class="text-blue-600 dark:text-blue-400 font-medium">
                                                {post.data.categories[0]}
                                            </span>
                                                    </>
                                            )}
                                        </div>
                                        <a href={`/blog/${post.id}/`} class="block group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">
                                            <h4 class="text-lg font-bold text-zinc-800 dark:text-zinc-100 truncate pr-4">
                                                {post.data.title}
                                            </h4>
                                        </a>
                                        {post.data.tags && (
                                                <div class="flex gap-2 mt-2">
                                                    {post.data.tags.map(tag => (
                                                            <span class="text-xs px-2 py-0.5 rounded-full bg-zinc-100 dark:bg-white/10 text-zinc-500 dark:text-zinc-400">
                                                #{tag}
                                            </span>
                                                    ))}
                                                </div>
                                        )}
                                    </div>

                                    {/* Optional: Show small thumbnail if available, or nothing */}
                                    {post.data.heroImage && (
                                            <div class="hidden sm:block flex-shrink-0 w-24 h-16 rounded-lg overflow-hidden bg-zinc-200 dark:bg-white/5">
                                                <img src={post.data.heroImage.src} alt="" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity" loading="lazy" />
                                            </div>
                                    )}
                                </article>
                        ))}
                    </div>
                </div>
            </section>
    ))}
</div>
