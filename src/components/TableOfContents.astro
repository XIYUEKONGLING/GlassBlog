---
import type { MarkdownHeading } from 'astro';

interface Props {
    headings: MarkdownHeading[];
}

const { headings = [] } = Astro.props;

const filteredHeadings = headings.filter((h) => h.depth >= 2 && h.depth <= 3);
---

{filteredHeadings.length > 0 && (
<nav class="toc-container p-4">
    <h2 class="text-lg font-bold mb-4 text-zinc-900 dark:text-zinc-100 flex items-center gap-2">
        <i class="fa-solid fa-list-ul text-sm opacity-70"></i>
        On this page
    </h2>

    <ul class="flex flex-col gap-2 text-sm border-l border-zinc-200 dark:border-white/10 pl-3">
        {filteredHeadings.map((heading) => (
                <li
                        class={`transition-colors duration-200 hover:text-blue-600 dark:hover:text-blue-400
                        ${heading.depth === 3 ? 'ml-4 text-xs opacity-80' : 'font-medium'}
                    `}
                >
                    <a href={`#${heading.slug}`} class="block py-1 text-zinc-600 dark:text-zinc-400 hover:text-blue-600 dark:hover:text-blue-400 truncate">
                        {heading.text}
                    </a>
                </li>
        ))}
    </ul>
</nav>
    )}

<script>
    const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
            const id = entry.target.getAttribute('id');
            if (!id) return;

            const link = document.querySelector(`.toc-container a[href="#${id}"]`);
            if (entry.isIntersecting) {
                document.querySelectorAll('.toc-container a').forEach(a => a.classList.remove('text-blue-600', 'dark:text-blue-400', 'font-bold'));
                link?.classList.add('text-blue-600', 'dark:text-blue-400', 'font-bold');
            }
        });
    }, { rootMargin: '-100px 0px -66%' });

    document.querySelectorAll('h2, h3').forEach((h) => observer.observe(h));
</script>
