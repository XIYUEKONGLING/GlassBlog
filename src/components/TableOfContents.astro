---
import type { MarkdownHeading } from 'astro';

interface Props {
    headings: MarkdownHeading[];
}

const { headings = [] } = Astro.props;

const filteredHeadings = headings.filter((h) => h.depth >= 2 && h.depth <= 3);
---

{filteredHeadings.length > 0 && (
<nav class="toc-container">
    <h2 class="text-lg font-bold mb-4 text-zinc-900 dark:text-zinc-100 flex items-center gap-2 px-2">
        <i class="fa-solid fa-list-ul text-sm opacity-70"></i>
        On this page
    </h2>

    <ul class="flex flex-col text-sm relative pl-2">
        <div class="absolute left-2 top-2 bottom-2 w-px bg-zinc-200 dark:bg-white/10 z-0"></div>

        {filteredHeadings.map((heading) => (
                <li class="relative z-10">
                    <a
                            href={`#${heading.slug}`}
                            class={`
                            block py-1.5 pr-2 transition-all duration-200 border-l-2 border-transparent rounded-r-md
                            text-zinc-500 dark:text-zinc-400 hover:text-blue-600 dark:hover:text-blue-400
                            ${heading.depth === 3 ? 'pl-6 text-xs' : 'pl-4 font-medium'}
                        `}
                    >
                        {heading.text}
                    </a>
                </li>
        ))}
    </ul>
</nav>
    )}

<script>
    const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
            const id = entry.target.getAttribute('id');
            if (!id) return;

            const link = document.querySelector(`.toc-container a[href="#${id}"]`);

            if (entry.isIntersecting) {
                document.querySelectorAll('.toc-container a').forEach(a => {
                    a.classList.remove('text-blue-600', 'dark:text-blue-400', 'border-blue-600', 'dark:border-blue-400', 'bg-blue-50/50', 'dark:bg-blue-900/10');
                    a.classList.add('border-transparent');
                });

                if (link) {
                    link.classList.remove('border-transparent');
                    link.classList.add('text-blue-600', 'dark:text-blue-400', 'border-blue-600', 'dark:border-blue-400', 'bg-blue-50/50', 'dark:bg-blue-900/10');
                }
            }
        });
    }, { rootMargin: '-100px 0px -66%' });

    document.querySelectorAll('h2, h3').forEach((h) => observer.observe(h));
</script>
